# Refine SPA App with Keycloak Authentication

<div align="center" style="margin: 30px;">
    <a href="https://refine.dev">
    <img alt="refine logo" src="https://refine.ams3.cdn.digitaloceanspaces.com/readme/refine-readme-banner.png">
    </a>
</div>
<br/>

Keycloakèªè¨¼ãŒçµ±åˆã•ã‚ŒãŸRefine SPAã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã€‚GCP Cloud Runã§ã®æœ¬æ ¼çš„ãªèªè¨¼ã‚·ã‚¹ãƒ†ãƒ ã‚’å®Ÿè£…ã€‚

## ğŸŒŸ ç‰¹å¾´

- âš›ï¸ **React 18** + **TypeScript** + **Vite**
- ğŸ¨ **Ant Design** UIã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ
- ğŸ” **Keycloak** èªè¨¼çµ±åˆ
- â˜ï¸ **GCP Cloud Run** ãƒ‡ãƒ—ãƒ­ã‚¤å¯¾å¿œ
- ğŸ³ **Docker** ãƒãƒ«ãƒã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£å¯¾å¿œï¼ˆARM/AMD64ï¼‰
- ğŸ› ï¸ **Makefile** ã«ã‚ˆã‚‹è‡ªå‹•åŒ–

## ğŸš€ ã‚¯ã‚¤ãƒƒã‚¯ã‚¹ã‚¿ãƒ¼ãƒˆ

### 1. ãƒªãƒã‚¸ãƒˆãƒªã®ã‚¯ãƒ­ãƒ¼ãƒ³

```bash
git clone [repository-url]
cd refine-spa-app
```

### 2. ä¾å­˜é–¢ä¿‚ã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«

```bash
make install
# ã¾ãŸã¯
npm install
```

### 3. ç’°å¢ƒè¨­å®š

```bash
make setup-env
# .env.local ã‚’ç·¨é›†ã—ã¦Keycloak URLã‚’è¨­å®š
```

### 4. é–‹ç™ºã‚µãƒ¼ãƒãƒ¼ã®èµ·å‹•

```bash
make dev
# ã¾ãŸã¯
npm run dev
```

## ğŸ”§ åˆ©ç”¨å¯èƒ½ãªã‚³ãƒãƒ³ãƒ‰

### é–‹ç™ºç”¨ã‚³ãƒãƒ³ãƒ‰

```bash
make install      # ä¾å­˜é–¢ä¿‚ã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
make dev          # é–‹ç™ºã‚µãƒ¼ãƒãƒ¼ã®èµ·å‹•
make build        # æœ¬ç•ªç”¨ãƒ“ãƒ«ãƒ‰
make lint         # ãƒªãƒ³ã‚¿ãƒ¼ã®å®Ÿè¡Œ
make test         # ãƒ†ã‚¹ãƒˆã®å®Ÿè¡Œ
```

### GCPãƒ‡ãƒ—ãƒ­ã‚¤ç”¨ã‚³ãƒãƒ³ãƒ‰

```bash
make setup-gcp            # GCPãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®è¨­å®š
make deploy-full          # å®Œå…¨ãƒ‡ãƒ—ãƒ­ã‚¤ãƒ¡ãƒ³ãƒˆ
make deploy-keycloak      # Keycloakã®ã¿ãƒ‡ãƒ—ãƒ­ã‚¤
make build-keycloak       # Keycloakã‚¤ãƒ¡ãƒ¼ã‚¸ãƒ“ãƒ«ãƒ‰
make create-db            # Cloud SQLãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ä½œæˆ
```

### é‹ç”¨ãƒ»ç›£è¦–ã‚³ãƒãƒ³ãƒ‰

```bash
make logs         # Cloud Runãƒ­ã‚°ã®è¡¨ç¤º
make status       # ã‚µãƒ¼ãƒ“ã‚¹çŠ¶æ³ã®ç¢ºèª
make clean        # ãƒ­ãƒ¼ã‚«ãƒ«ãƒ•ã‚¡ã‚¤ãƒ«ã®ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—
```

## ğŸ—ï¸ ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£

### ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰
- **Framework**: Refine (React)
- **UI Library**: Ant Design
- **Build Tool**: Vite
- **Authentication**: Keycloak JS

### ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ï¼ˆèªè¨¼ï¼‰
- **Authentication Server**: Keycloak
- **Platform**: GCP Cloud Run
- **Database**: Cloud SQL (PostgreSQL)
- **Secrets**: Secret Manager

### ã‚¤ãƒ³ãƒ•ãƒ©
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   React SPA     â”‚â”€â”€â”€â”€â”‚   Cloud Run     â”‚â”€â”€â”€â”€â”‚   Cloud SQL     â”‚
â”‚   (Frontend)    â”‚    â”‚   (Keycloak)    â”‚    â”‚ (PostgreSQL)    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                       â”‚ Secret Manager  â”‚
                       â”‚ (DB Credentials)â”‚
                       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ” èªè¨¼è¨­å®š

### Keycloakè¨­å®š

1. **ãƒ¬ãƒ«ãƒ **: `refine-app`
2. **ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆ**: `refine-spa-app`
3. **Client Type**: Public (SPA)
4. **Redirect URIs**: 
   - `http://localhost:5173/*`
   - `https://your-domain.com/*`

### ç’°å¢ƒå¤‰æ•°

```env
VITE_KEYCLOAK_URL=https://your-keycloak-instance.run.app
VITE_KEYCLOAK_REALM=refine-app
VITE_KEYCLOAK_CLIENT_ID=refine-spa-app
```

## ğŸ³ Docker & ãƒãƒ«ãƒã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£

ã“ã®ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã¯**ARM64 (Apple Silicon/Windows ARM)** ç’°å¢ƒã‹ã‚‰**AMD64 (Cloud Run)** ç”¨ã®ã‚¤ãƒ¡ãƒ¼ã‚¸ã‚’ãƒ“ãƒ«ãƒ‰å¯èƒ½ï¼š

```bash
# ARMç’°å¢ƒã‹ã‚‰AMD64ã‚¤ãƒ¡ãƒ¼ã‚¸ã‚’ãƒ“ãƒ«ãƒ‰
docker buildx build --platform linux/amd64 -t gcr.io/PROJECT/keycloak .
```

## ğŸŒ ãƒ‡ãƒ—ãƒ­ã‚¤ãƒ¡ãƒ³ãƒˆ

### ãƒã‚¤ãƒ–ãƒªãƒƒãƒ‰ãƒ‡ãƒ—ãƒ­ã‚¤ï¼ˆæ¨å¥¨ï¼‰

Terraform + Shellè£œå®Œã‚¢ãƒ—ãƒ­ãƒ¼ãƒã§å®‰å®šã—ãŸãƒ‡ãƒ—ãƒ­ã‚¤ãƒ¡ãƒ³ãƒˆã‚’å®Ÿè¡Œï¼š

```bash
# ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆIDã‚’è¨­å®š
export PROJECT_ID=your-gcp-project-id

# ãƒã‚¤ãƒ–ãƒªãƒƒãƒ‰ãƒ‡ãƒ—ãƒ­ã‚¤ãƒ¡ãƒ³ãƒˆï¼ˆAPIæœ‰åŠ¹åŒ– + Terraformï¼‰
make hybrid-deploy PROJECT_ID=$PROJECT_ID
```

**ãƒã‚¤ãƒ–ãƒªãƒƒãƒ‰ãƒ‡ãƒ—ãƒ­ã‚¤ã®æµã‚Œï¼š**
1. ğŸ”§ GCP APIè‡ªå‹•æœ‰åŠ¹åŒ–ï¼ˆShellï¼‰
2. ğŸ³ Keycloakã‚¤ãƒ¡ãƒ¼ã‚¸ãƒ“ãƒ«ãƒ‰ãƒ»ãƒ—ãƒƒã‚·ãƒ¥ï¼ˆShellï¼‰
3. ğŸ—ï¸ ã‚¤ãƒ³ãƒ•ãƒ©ã‚¹ãƒˆãƒ©ã‚¯ãƒãƒ£ä½œæˆï¼ˆTerraformï¼‰

### å¾“æ¥ã®è‡ªå‹•ãƒ‡ãƒ—ãƒ­ã‚¤

```bash
# å®Œå…¨ã‚·ã‚§ãƒ«ãƒ™ãƒ¼ã‚¹ãƒ‡ãƒ—ãƒ­ã‚¤ãƒ¡ãƒ³ãƒˆ
make deploy-full PROJECT_ID=$PROJECT_ID
```

### Terraformã®ã¿ä½¿ç”¨

```bash
# äº‹å‰ã«APIã‚’æœ‰åŠ¹åŒ–æ¸ˆã¿ã®å ´åˆ
make tf-init
make tf-plan
make tf-apply
```

### æ‰‹å‹•ãƒ‡ãƒ—ãƒ­ã‚¤

1. **GCPãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆè¨­å®š**
   ```bash
   make setup-gcp PROJECT_ID=your-project-id
   ```

2. **ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ä½œæˆ**
   ```bash
   make create-db
   ```

3. **Keycloakãƒ‡ãƒ—ãƒ­ã‚¤**
   ```bash
   make deploy-keycloak
   ```

## ğŸ“Š ç›£è¦–ã¨ãƒ­ã‚°

```bash
# ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ãƒ­ã‚°ç›£è¦–
make logs

# ã‚µãƒ¼ãƒ“ã‚¹çŠ¶æ³ç¢ºèª
make status
```

## ğŸ› ï¸ é–‹ç™ºç’°å¢ƒ

### å¿…è¦ãªãƒ„ãƒ¼ãƒ«
- Node.js 18+
- Docker
- Google Cloud CLI
- Make

### å¯¾å¿œç’°å¢ƒ
- âœ… macOS (Intel/Apple Silicon)
- âœ… Windows (x64/ARM64) + WSL2
- âœ… Linux (x64/ARM64)

## ğŸ“š è©³ç´°ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ

- [Keycloakè¨­å®šã‚¬ã‚¤ãƒ‰](./gcp-infrastructure/README.md)
- [ãƒ‡ãƒ—ãƒ­ã‚¤ãƒ¡ãƒ³ãƒˆã‚¬ã‚¤ãƒ‰](./gcp-infrastructure/DEPLOYMENT_GUIDE.md)
- [Claudeé–‹ç™ºã‚¬ã‚¤ãƒ‰](./CLAUDE.md)

## ğŸ”— é–¢é€£ãƒªãƒ³ã‚¯

- **Refine**: [ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ](https://refine.dev/docs)
- **Keycloak**: [ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ](https://www.keycloak.org/documentation)
- **GCP Cloud Run**: [ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ](https://cloud.google.com/run/docs)

## ğŸ“„ ãƒ©ã‚¤ã‚»ãƒ³ã‚¹

MIT

## ğŸ™‹â€â™‚ï¸ ã‚µãƒãƒ¼ãƒˆ

å•é¡ŒãŒç™ºç”Ÿã—ãŸå ´åˆï¼š

1. [Issues](https://github.com/your-repo/issues) ã§ãƒã‚°å ±å‘Š
2. [Discussions](https://github.com/your-repo/discussions) ã§è³ªå•
3. `make logs` ã§ãƒ­ã‚°ã‚’ç¢ºèª
4. [ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ã‚¬ã‚¤ãƒ‰](./gcp-infrastructure/DEPLOYMENT_GUIDE.md#ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°) ã‚’å‚ç…§
